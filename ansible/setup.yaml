---

- name: Setup Server
  hosts: cybertron
  become: true
  vars:
    ansible_user: optimus
    sys_packages: ["curl", "git", "ca-certificates", "apt-transport-https", "software-properties-common", "gnupg", "ufw"]
    server_name: cybertron
    copy_local_ssh_key: "{{ lookup('ansible.builtin.file', lookup('ansible.builtin.env', 'HOME') + '/.ssh/id_ed25519.pub') }}"
  roles:
    - role: security
    - role: docker
  
  tasks:
    - name: Set the environment
      template:
        src: roles/common/templates/set_environment.j2
        dest: /etc/profile.d/set_environment.sh
        owner: "{{ create_user }}"
        group: "{{ create_user }}"
        mode: '755'
      notify:
        - Reload profile

  handlers:
    - name: Reload profile
      command: source /etc/profile.d/set_environment.sh
      async: 10
      poll: 0